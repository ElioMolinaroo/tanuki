{# Sidebar with Table of Contents for Docs Mode #}
<aside id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar__header">
        <span class="sidebar__title">Documentation</span>
        <button class="sidebar__close" aria-label="Close sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6 6 18"/>
                <path d="m6 6 12 12"/>
            </svg>
        </button>
    </div>

    <nav class="sidebar__content">
        <div class="toc">
            {# Get the root section for docs #}
            {% set root_section = get_section(path="_index.md") %}

            {% if root_section %}
            <div class="toc__section">
                <ul class="toc__list">
                    {% for pg in root_section.pages %}
                    <li class="toc__item">
                        <a href="{{ pg.permalink | safe }}" class="toc__link {% if current_path is defined and current_path == pg.path %}active{% endif %}">
                            {{ pg.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            {# Subsections #}
            {% if root_section.subsections %}
            {% for subsection_path in root_section.subsections %}
            {% set subsection = get_section(path=subsection_path) %}
            <div class="toc__section">
                <div class="toc__section-title">{{ subsection.title }}</div>
                <ul class="toc__list">
                    {% for pg in subsection.pages %}
                    <li class="toc__item">
                        <a href="{{ pg.permalink | safe }}" class="toc__link {% if current_path is defined and current_path == pg.path %}active{% endif %}">
                            {{ pg.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
            {% endif %}
            {% endif %}

            {# On this page - headings from current page #}
            {% if page and page.toc %}
            <div class="toc__section">
                <div class="toc__section-title">On this page</div>
                <ul class="toc__list">
                    {% for item in page.toc %}
                    <li class="toc__item">
                        <a href="#{{ item.id }}" class="toc__link">
                            {{ item.title }}
                        </a>
                        {% if item.children %}
                        <ul class="toc__list toc__list--nested">
                            {% for child in item.children %}
                            <li class="toc__item">
                                <a href="#{{ child.id }}" class="toc__link">
                                    {{ child.title }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>

    <div class="sidebar__footer">
        <a href="{{ get_url(path='print.html') | safe }}" class="print-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 6 2 18 2 18 9"/>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                <rect width="12" height="8" x="6" y="14"/>
            </svg>
            Print all pages
        </a>
    </div>
</aside>
