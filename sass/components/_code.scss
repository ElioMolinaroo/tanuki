// =============================================================================
// Code Blocks - raskell.io style
// =============================================================================

pre {
  position: relative;
  margin: 1.5rem 0;
  padding: 0;
  background: var(--color-code-bg);
  border: 1px solid var(--color-code-border);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow-lg);

  // Accent line at top
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(
      90deg,
      var(--color-code-accent),
      transparent 50%
    );
  }

  code {
    display: block;
    padding: 1.5rem;
    padding-top: 2.5rem; // Space for language label
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    line-height: 1.7;
    overflow-x: auto;
    color: var(--ctp-text);

    // Remove inline code styling
    background: none;
    border-radius: 0;
  }
}

// Language label
pre[data-lang]::after {
  content: attr(data-lang);
  position: absolute;
  top: 0;
  left: 0;
  padding: 0.4rem 0.75rem;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--ctp-blue);
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  border-bottom-right-radius: 6px;
}

// Copy button
.copy-button {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.6rem;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 6px;
  opacity: 0;
  transition: all 0.2s ease;
  cursor: pointer;
  backdrop-filter: blur(8px);

  svg {
    width: 14px;
    height: 14px;
    stroke-width: 2;
  }

  &:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: var(--color-accent);
    color: var(--color-text);
  }

  &.copied {
    background: rgba(166, 227, 161, 0.15);
    border-color: var(--ctp-green);
    color: var(--ctp-green);
  }
}

pre:hover .copy-button {
  opacity: 1;
}

// Line numbers (if enabled)
pre.line-numbers {
  code {
    counter-reset: line;

    .line::before {
      counter-increment: line;
      content: counter(line);
      display: inline-block;
      width: 2.5rem;
      margin-right: 1rem;
      padding-right: 0.5rem;
      text-align: right;
      color: var(--ctp-overlay0);
      border-right: 1px solid var(--color-border);
      user-select: none;
    }
  }
}

// Highlighted lines
pre code .highlighted {
  background: rgba(203, 166, 247, 0.1);
  display: block;
  margin: 0 -1.5rem;
  padding: 0 1.5rem;
  border-left: 3px solid var(--color-accent);
}

// =============================================================================
// Syntax Highlighting (Catppuccin Mocha)
// =============================================================================

pre code {
  .comment,
  .prolog,
  .doctype,
  .cdata {
    color: var(--ctp-overlay1);
    font-style: italic;
  }

  .punctuation {
    color: var(--ctp-overlay2);
  }

  .namespace {
    opacity: 0.8;
  }

  .property,
  .tag,
  .boolean,
  .number,
  .constant,
  .symbol {
    color: var(--ctp-peach);
  }

  .selector,
  .attr-name,
  .string,
  .char,
  .builtin {
    color: var(--ctp-green);
  }

  .operator,
  .entity,
  .url,
  .variable {
    color: var(--ctp-sky);
  }

  .atrule,
  .attr-value,
  .function,
  .class-name {
    color: var(--ctp-blue);
  }

  .keyword {
    color: var(--ctp-mauve);
  }

  .regex,
  .important {
    color: var(--ctp-yellow);
  }

  .important,
  .bold {
    font-weight: bold;
  }

  .italic {
    font-style: italic;
  }

  .entity {
    cursor: help;
  }

  // Additional token styles
  .inserted {
    color: var(--ctp-green);
    background: rgba(166, 227, 161, 0.1);
  }

  .deleted {
    color: var(--ctp-red);
    background: rgba(243, 139, 168, 0.1);
  }
}

// Light theme overrides
[data-theme="light"] pre code {
  .comment,
  .prolog,
  .doctype,
  .cdata {
    color: var(--ctp-overlay1);
  }

  .punctuation {
    color: var(--ctp-overlay2);
  }
}
